-- CRIANDO O BANCO DE DADOS
DROP DATABASE IF EXISTS tcc;
CREATE DATABASE IF NOT EXISTS tcc
default character set utf8
default collate utf8_general_ci;

use tcc; 

/*criando as tabelas*/
/*Tabela Cardapio*/
create table Cardapio(
cod_Cardapio int(100) unsigned not null auto_increment primary key,
categoria_Cardapio VARCHAR(100) NOT NULL,
foto_Cardapio VARCHAR(100) not null
);
/*Tabela Item*/
create table Item (
cod_Item int(100) not null auto_increment primary key,
cod_Cardapio int(100) unsigned not null,
nome_Item VARCHAR(100) NOT NULL,
descricao_Item VARCHAR(100) NOT NULL,
preco_Item DECIMAL(10,2) NOT NULL,
Ativo tinyint(1) default 1 not null,
foto_Item VARCHAR(100) not null/*Utilização de Blob para armazenar a Imagem*/
);
/*Tabela Mesa*/
create table Mesa(
qr_Code VARCHAR(100) UNIQUE not null primary key,
numero_Mesa VARCHAR(100) NOT NULL
);
/*tabela Pedido*/
create table Pedido(
cod_Pedido INT(100) NOT NULL AUTO_INCREMENT primary key,
horario_Pedido timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
observacao_Pedido VARCHAR(200) NOT NULL,
qr_Code VARCHAR(100) NOT NULL
);

/*tabela ItemPedido*/
create table ItemPedido(
cod_Pedido INT(100) NOT NULL,
cod_Item int(100) not null,
quantidade INT(100) not null
);

/*tabela Funcionario*/
create table Funcionario(
cod_Funcionario INT(100) UNSIGNED NOT NULL AUTO_INCREMENT primary key,
nome_Funcionario VARCHAR(100) NOT NULL,
cpf_Funcionario varchar(14) unique not null,
telefone_Funcionario varchar(16) unique not null,
cargo_Funcionario ENUM('Garçom','Cozinheiro','Administrador'),
email_Funcionario VARCHAR(100) unique NOT NULL,
Ativo tinyint(1) default 1 not null,
senha VARCHAR(50) NOT NULL
);
/*tabela Garçom 
 create table Garcom(
 cod_Funcionario INT(100) UNSIGNED NOT NULL,
 cod_Pedido INT(100) NOT NULL
 );
 tabela Cozinha
 create table Cozinha(
 cod_Funcionario INT(100) UNSIGNED NOT NULL,
 cod_Pedido INT(100) NOT NULL
 );
 /*tabela Administracao
 create table Administrador(
 cod_ADM INT(100) UNSIGNED NOT NULL AUTO_INCREMENT primary key,
 cod_Funcionario INT(100) UNSIGNED NOT NULL
 );*/


/*adicionando a chaves estrangeiras em suas respectivas tabelas*/
ALTER TABLE Item ADD CONSTRAINT FK_cod_Cardapio
FOREIGN KEY (cod_Cardapio)
REFERENCES Cardapio (cod_Cardapio)
ON DELETE CASCADE;

ALTER TABLE Pedido ADD CONSTRAINT FK_qrCode
FOREIGN KEY (qr_Code)
REFERENCES Mesa (qr_Code);

ALTER TABLE ItemPedido ADD CONSTRAINT FK_Item_Pedido/*as FK nao tem o mesmo nome pois o banco não permite nomes duplicados*/
FOREIGN KEY (cod_Item)
REFERENCES Item (cod_Item);

ALTER TABLE ItemPedido ADD CONSTRAINT FK_codigo_Pedidos/*as FK nao tem o mesmo nome pois o banco não permite nomes duplicados*/
FOREIGN KEY (cod_Pedido)
REFERENCES Pedido (cod_Pedido);

/*ALTER TABLE Cozinha ADD CONSTRAINT FK_cod_Funcionario
FOREIGN KEY (cod_Funcionario)
REFERENCES Funcionario (cod_Funcionario)
ON DELETE CASCADE;

ALTER TABLE Cozinha ADD CONSTRAINT FK_cod_Ped
FOREIGN KEY (cod_Pedido)
REFERENCES Pedido (cod_Pedido);

ALTER TABLE Garcom ADD CONSTRAINT FK_codFuncionario
FOREIGN KEY (cod_Funcionario)
REFERENCES Funcionario (cod_Funcionario)
ON DELETE CASCADE;

ALTER TABLE Garcom ADD CONSTRAINT FK_codPedido
FOREIGN KEY (cod_Pedido)
REFERENCES Pedido (cod_Pedido)
ON DELETE CASCADE;

ALTER TABLE Administrador ADD CONSTRAINT FK_codFuncionario_adm
FOREIGN KEY (cod_Funcionario)
REFERENCES Funcionario (cod_Funcionario)
ON DELETE CASCADE;*/

INSERT INTO cardapio (categoria_cardapio, foto_Cardapio) VALUES
('Lanches','teste.jpg'),
('Sobremesas','teste.jpg'), 
('Bebidas','teste.jpg'), 
('Pratos','teste.jpg');
SELECT * FROM cardapio;

INSERT INTO item (nome_Item, preco_Item, descricao_Item, cod_Cardapio, foto_Item) values
('X-salada', 13.00, 'hambúrguer de carne bovina 100g, pâo de hambúrguer, salada, tomate e mussarela', 1, '7b4c618f83bacc5d24ba9673855db486.jpg'),
('X-egg', 14.00, 'hambúrguer de carne bovina 100g, pâo de hambúrguer, salada, tomate, mussarela e 2 ovos', 1, '2606da6d5e082d3145b51659c7d6e889.jpg'),
('Açai', 20.00, 'Açai na tigela 500ml, Acompanhamentos: 2 frutas, granola, leite em pó, leite condensado', 2, '905d3549f6be6dc19b86ac79c53ddc2d.jpg'),
('Bolo de brigadeiro', 7.00, 'Massa de chocolate com recheio e cobertura de brigadeiro e granulado de chocolate de pote de 250ml', 2, '16e65a2ddddbaa9be773f1057e86c1fb.jpg'),
('Coca-Cola', 6.00, 'Cola-cola 400ml', 3, 'f3580ae5eeddaa04d744704679a586a9.jpg'),
('Heineken', 12.00, 'Heineken 400ml', 3, '2aecc7e9ed2d33e259312f6da778fad1.jpg'),
('File Acebolado', 21.00, 'File Acebolado com arroz soltinho, feijão fresco, faroja e salada', 4, '3a63dbaece1242ec415c61904ad8bb81.jpg'),
('File Grelhado', 21.00, 'File Grelhado com arroz soltinho, feijão fresco, faroja e salada', 4, 'adada571f32b663cefbaad29ec7ce38e.jpg');
select * from item;

INSERT INTO mesa (qr_Code, numero_Mesa) VALUES 
('qrcode1','Mesa 01'),
('qrcode2','Mesa 02'),
('qrcode3','Mesa 03'),
('qrcode4','Mesa 04'),
('qrcode5','Mesa 05');
SELECT * FROM mesa;


INSERT INTO pedido (observacao_Pedido, qr_Code) VALUES 
('X-SALADA SEM SALADA e COCA SEM GELO','qrcode1'),
('X-EGG SEM OVO','qrcode2'),
(null,'qrcode3'),
(null,'qrcode4');   
select * from pedido;

INSERT INTO itempedido (cod_Pedido, cod_Item, quantidade) VALUES 
(1,1,1),
(1,5,1),
(2,2,1),
(3,7,1);
SELECT * FROM itempedido;

INSERT INTO funcionario (nome_Funcionario, cpf_Funcionario, telefone_Funcionario, cargo_Funcionario, email_Funcionario, senha) VALUES 
('Breno André Roberto Teixeira', '408.097.038-23', '(11) 98116-1538', 'Administrador', 'brenoandre@gmail.com', '123'),
('Rafael Guilherme Matheus Ferreira', '585.746.378-58', '(11) 98761-3752', 'Garçom', 'rafaelguilherme@gmail.com', '123'),
('Carla Natália Porto', '956.669.328-10', '(11) 98911-6170', 'Cozinheiro', 'carlaporto@gmail.com', '123'),
('ALOK', '408.292.038-23', '(11) 98336-1538', 'Administrador', 'ALOK@gmail.com', '123');
select * from funcionario 
order by nome_Funcionario asc;

/*INSERT INTO cozinha (cod_Funcionario, cod_Pedido) VALUES 
(3,1),
(3,1),
(3,2);

INSERT INTO garcom (cod_Funcionario, cod_Pedido) VALUES 
(2,1),
(2,1),
(2,2);

INSERT INTO administrador (cod_Funcionario) VALUES 
(1);
SELECT * FROM administrador;*/

select c.cod_Pedido, d.numero_Mesa, a.cod_Item, b.nome_Item, c.observacao_Pedido, a.quantidade, c.horario_Pedido, b.cod_Cardapio, e.categoria_Cardapio
from itempedido a, item b, pedido c, mesa d, cardapio e
where a.cod_Item = b.cod_Item and c.cod_Pedido = a.cod_Pedido and d.qr_Code = c.qr_Code and b.cod_Cardapio = e.cod_Cardapio; 

select a.cod_Item, a.cod_Cardapio, a.nome_Item, a.descricao_Item, a.preco_Item, a.Ativo, a.foto_Item, b.categoria_Cardapio
from item a, cardapio b
where a.cod_Cardapio = b.cod_Cardapio and a.Ativo = 1
order by a.nome_Item asc;

select * from item a
where a.cod_Cardapio = 1;